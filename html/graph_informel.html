<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Graphe Informel - Éditeur</title>
  <script src="https://unpkg.com/cytoscape@3.21.1/dist/cytoscape.min.js"></script>
  <style>
    #cy {
      width: 80%;
      height: 600px;
      float: left;
      border: 1px solid #ccc;
    }
    #formulaire {
      width: 18%;
      float: right;
      padding: 10px;
      border: 1px solid #aaa;
    }
    label, select, input { display: block; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div id="cy"></div>
  <div id="formulaire">
    <h3>Ajouter une relation</h3>
    <label>Source:</label>
    <select id="source"></select>

    <label>Cible:</label>
    <select id="target"></select>

    <label>Type:</label>
    <input type="text" id="type_relation" placeholder="ex: mentorat">

    <label>Direction:</label>
    <select id="direction">
      <option value="Simple">Simple</option>
      <option value="Double">Double</option>
    </select>

    <label>Impact Source > Cible:</label>
    <select id="impact_src">
      <option>Faible</option><option>Moyen</option><option>Fort</option>
    </select>

    <label>Impact Cible > Source:</label>
    <select id="impact_tgt">
      <option>Faible</option><option>Moyen</option><option>Fort</option>
    </select>

    <label>Nature:</label>
    <select id="nature">
      <option>Positive</option><option>Négative</option><option>Neutre</option>
    </select>

    <label>Durée:</label>
    <input type="number" id="duree" min="1">

    <button onclick="ajouterRelation()">Ajouter</button>
    <hr>
    <button onclick="sauvegarderJSON()">Exporter JSON</button>
  </div>

  <script>
    const cy = cytoscape({
      container: document.getElementById('cy'),
      elements: [
        { data: { id: 'a', label: 'Alice' } },
        { data: { id: 'b', label: 'Bob' } },
        { data: { id: 'c', label: 'Charlie' } }
      ],
      style: [
        { selector: 'node', style: { 'label': 'data(label)', 'background-color': '#2E86C1', 'color': '#fff' } },
        { selector: 'edge', style: { 'curve-style': 'bezier', 'target-arrow-shape': 'triangle', 'label': 'data(label)' } }
      ],
      layout: { name: 'grid' }
    });

    const acteurs = ['a', 'b', 'c'];
    const noms = { 'a': 'Alice', 'b': 'Bob', 'c': 'Charlie' };

    const sourceSelect = document.getElementById('source');
    const targetSelect = document.getElementById('target');

    acteurs.forEach(id => {
      let opt1 = new Option(noms[id], id);
      let opt2 = new Option(noms[id], id);
      sourceSelect.add(opt1.cloneNode(true));
      targetSelect.add(opt2.cloneNode(true));
    });

    function ajouterRelation() {
      const src = sourceSelect.value;
      const tgt = targetSelect.value;
      const type = document.getElementById('type_relation').value;
      const dir = document.getElementById('direction').value;
      const impactSrc = document.getElementById('impact_src').value;
      const impactTgt = document.getElementById('impact_tgt').value;
      const nature = document.getElementById('nature').value;
      const duree = document.getElementById('duree').value;

      cy.add({
        group: 'edges',
        data: {
          id: `${src}_${tgt}_${Date.now()}`,
          source: src,
          target: tgt,
          label: `${type} (${impactSrc}) [${nature}]`
        }
      });

      if (dir === 'Double') {
        cy.add({
          group: 'edges',
          data: {
            id: `${tgt}_${src}_${Date.now()}`,
            source: tgt,
            target: src,
            label: `${type} (${impactTgt}) [${nature}]`
          }
        });
      }
    }

    function sauvegarderJSON() {
      const json = cy.json();
      console.log(JSON.stringify(json, null, 2));
      alert("Export JSON dans la console navigateur !");
    }
  </script>
</body>
</html>
